{% extends 'base.html' %}

{% block titulo %}Ver Pedidos{% endblock %}

{% block content %}
<h2 class="mb-4 text-center" style="color: #6a9acb;">Lista de Pedidos</h2>

<div class="text-end mb-3">
    <a href="{% url 'agregar_pedido' %}" class="btn btn-primary">
        <i class="fas fa-plus-circle"></i> Agregar Nuevo Pedido
    </a>
</div>

{% if pedidos %}
<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>ID Pedido</th>
                <th>Usuario</th>
                <th>Productos</th>  <!-- Nueva columna -->
                <th>Fecha Pedido</th>
                <th>Estado</th>
                <th>Total</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr>
                <td>{{ pedido.id_pedido }}</td>
                <td>{{ pedido.usuario.nombre }} {{ pedido.usuario.apellido }}</td>
                <td>
                    {% for detalle in pedido.detalles.all %}
                        {{ detalle.producto.nombre }} (x{{ detalle.cantidad }})<br>
                    {% empty %}
                        Sin productos
                    {% endfor %}
                </td>
                <td>{{ pedido.fecha_pedido|date:"d M Y H:i" }}</td>
                <td><span class="badge bg-info text-dark">{{ pedido.estado_pedido }}</span></td>
                <td>${{ pedido.total_pedido }}</td>
                <td>
                    <a href="{% url 'actualizar_pedido' pedido.id_pedido %}" class="btn btn-sm btn-info text-white me-1">Editar</a>
                    <a href="{% url 'borrar_pedido' pedido.id_pedido %}" class="btn btn-sm btn-danger">Eliminar</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info text-center">No hay pedidos registrados.</div>
{% endif %}
{% endblock %}
